# https://github.com/travis-ci/docs-travis-ci-com/issues/910
language: minimal
dist: trusty
sudo: required

env:
  # Matrix for testing against multiple OSes as needed in the future
  matrix:
    - OS_TYPE=centos OS_VERSION=7

services:
  - docker

before_install:
  - sudo apt-get update
  - openssl aes-256-cbc -K $encrypted_0d83e5d68220_key -iv $encrypted_0d83e5d68220_iv -in deploy_rsa.enc -out deploy_rsa -d
  - rm deploy_rsa.enc
  # - eval "$(ssh-agent -s)"
  - chmod 600 deploy_rsa
  # - ssh-add deploy_rsa
  - sudo cp deploy_rsa /root/.ssh/
  - sudo docker pull centos:centos${OS_VERSION}
  - sudo docker build --no-cache --rm --file=docker/Dockerfile.centos-${OS_VERSION} -t puppettest .
  - sudo docker run puppettest

  # - bash scripts/install.sh

script:
  - bash scripts/build.sh

after_success:
  - bash scripts/deploy.sh
